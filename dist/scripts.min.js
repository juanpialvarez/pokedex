import e from "./pokemon.js";
let pokeRepository = (function () {
  let t = [],
    n = "https://pokeapi.co/api/v2/pokemon/?limit=200&offset=0";
  function o() {
    return fetch(n)
      .then((e) => e.json())
      .then((t) => {
        t.results.forEach((t) => {
          let n = new e();
          (n.name = t.name), (n.url = t.url), i(n);
        });
      })
      .catch((e) => console.log(e));
  }
  function i(n) {
    let o = !1;
    Object.keys(n).every((e) => null !== n[e] || ((o = !0), !1)),
      n instanceof e && t.push(n);
  }
  function l(e) {
    let t = document.querySelector(".pokemon-list"),
      n = document.createElement("li");
    n.classList.add("group-list-item");
    let o = document.createElement("button");
    (o.innerText = e.getName),
      o.classList.add("pokemon-button"),
      o.classList.add("btn"),
      o.classList.add("btn-warning"),
      o.classList.add("btn-block-sm"),
      o.setAttribute("data-toggle", "modal"),
      o.setAttribute("data-target", "#pokemon-modal"),
      t.appendChild(n).appendChild(o),
      o.addEventListener("click", () => {
        s(e).then(() => {
          var t;
          let n, o, i, l;
          return (
            (t = e),
            (n = document.getElementById("pokemon-modal-label")),
            (n.innerText = t.getName),
            a(n),
            (o = document.querySelector(".modal-body")),
            (o.innerHTML = ""),
            (i = document.createElement("h3")),
            (i.innerText = `Height: ${t.getHeight}

        Type: ${t.getType}`),
            (l = document.createElement("img")),
            void ((l.src = t.getImage), o.appendChild(i), o.appendChild(l))
          );
        });
      }),
      a(o);
  }
  function a(e) {
    e.innerText =
      e.innerText.charAt(0).toLocaleUpperCase() + e.innerText.slice(1);
  }
  function r() {
    return t;
  }
  function s(e) {
    return fetch(e.getUrl)
      .then((e) => e.json())
      .then((t) => {
        (e.image = t.sprites.front_default), (e.height = t.height);
        let n = [];
        t.types.forEach((e) => {
          n.push(e.type.name);
        }),
          (e.types = n);
      })
      .catch((e) => console.log(e));
  }
  function c() {
    fetch(n)
      .then((e) => e.json())
      .then((e) => {
        e.next && (n = e.next);
      })
      .then(() => {
        t = [];
        (document.querySelector(".pokemon-list").innerHTML = ""), d();
      })
      .catch((e) => console.log(e));
  }
  function p() {
    fetch(n)
      .then((e) => e.json())
      .then((e) => {
        e.previous && e.next && (n = e.previous),
          e.previous &&
            !e.next &&
            (n = "https://pokeapi.co/api/v2/pokemon/?offset=1000&limit=200");
      })
      .then(() => {
        t = [];
        (document.querySelector(".pokemon-list").innerHTML = ""), d();
      })
      .catch((e) => console.log(e));
  }
  function d() {
    o().then(() => {
      t.forEach((e) => l(e));
    });
    let e = document.getElementById("previous"),
      n = document.getElementById("next");
    e.addEventListener("click", p), n.addEventListener("click", c);
    document.querySelector("#search-submit").addEventListener("submit", () => {
      m();
    });
  }
  function m() {
    let o = document.getElementById("search").value;
    if (o) {
      t = [];
      (document.querySelector(".pokemon-list").innerHTML = ""),
        fetch((n = `https://pokeapi.co/api/v2/pokemon/${o.toLowerCase()}/`))
          .then((e) => e.json())
          .then((t) => {
            let n = new e();
            (n.name = t.name), (n.url = t.url), l(n);
          })
          .catch((e) => console.log(e));
    } else {
      t = [];
      (document.querySelector(".pokemon-list").innerHTML = ""),
        (n = "https://pokeapi.co/api/v2/pokemon/?limit=200&offset=0"),
        d();
    }
  }
  return {
    searchPokemon: m,
    previousPage: p,
    nextPage: c,
    loadMain: d,
    getAll: r,
    loadList: o,
    add: i,
    addListItem: l,
    loadDetails: s,
  };
})();
pokeRepository.loadMain();
